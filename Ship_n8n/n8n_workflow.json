{
    "name": "Shopby âœ Cornerlogis ì¼ì¼ ìë™ì¶œê³ ",
    "nodes": [
      {
        "parameters": {
          "triggerTimes": {
            "item": [
              {
                "mode": "everyDay",
                "hour": 13,
                "minute": 0
              }
            ],
            "timezone": "Asia/Seoul"
          }
        },
        "type": "n8n-nodes-base.cron",
        "typeVersion": 1,
        "position": [200, 200],
        "name": "ë§¤ì¼ 13:00"
      },
      {
        "parameters": {
          "functionCode": "const now = new Date();\nconst KST = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Seoul' }));\nconst y = KST.getFullYear();\nconst m = String(KST.getMonth()+1).padStart(2,'0');\nconst d = String(KST.getDate()).padStart(2,'0');\nconst from = `${y}-${m}-${d} 00:00:00`;\nconst to   = `${y}-${m}-${d} 13:00:00`;\nreturn [{ json: { from, to }}];"
        },
        "type": "n8n-nodes-base.function",
        "typeVersion": 2,
        "position": [440, 200],
        "name": "ê¸ˆì¼ 00:00~13:00 ë²”ìœ„"
      },
      {
        "parameters": {
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "url": "https://server-docs.shopby.co.kr", 
          "options": {
            "response": { "responseFormat": "json" }
          },
          "sendQuery": true,
          "queryParametersUi": {
            "parameter": [
              { "name": "status", "value": "PAY_DONE" },
              { "name": "from", "value": "={{$json.from}}" },
              { "name": "to",   "value": "={{$json.to}}" },
              { "name": "page", "value": "0" },
              { "name": "size", "value": "100" }
            ]
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4,
        "position": [680, 200],
        "name": "ìƒµë°”ì´ ì£¼ë¬¸ ì¡°íšŒ",
        "notesInFlow": true,
        "notes": "â–¶ ì‹¤ì œ ì£¼ë¬¸ API ì—”ë“œí¬ì¸íŠ¸ë¡œ êµì²´(ì˜ˆ: https://{your-shopby-host}/server/orders)\nâ–¶ ì¸ì¦ í—¤ë”(Authorization / systemKey / mallKey ë“±) í¬ë¦¬ë´ì…œë¡œ ì—°ê²°\nâ–¶ í˜ì´ì§€ë„¤ì´ì…˜ í•„ìš” ì‹œ Split In Batchesë¡œ ë£¨í”„"
      },
      {
        "parameters": {
          "operation": "read",
          "authentication": "serviceAccount",
          "sheetId": "1G7evb2MyxG8IBtOBn9pFmtTEyZ0uTeLZpp37XF4ntsU",
          "range": "ğŸ“ìœ„íƒìˆ˜ê±° ìƒí’ˆì •ë³´!A:B",
          "options": { "rawData": false, "valueRenderMode": "UNFORMATTED_VALUE" }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 6,
        "position": [680, 440],
        "name": "SKU ë§¤í•‘ ì‹œíŠ¸ ì½ê¸°"
      },
      {
        "parameters": {
          "functionCode": "// items[0]: ìƒµë°”ì´ ì‘ë‹µ, items[1]: ë§¤í•‘ì‹œíŠ¸\nconst orders = Array.isArray(items[0].json.data) ? items[0].json.data : (items[0].json.orders || []);\nconst rows = items[1].json;\n// ì‹œíŠ¸ í—¤ë” ê°€ì •: A=SHOPBY_SKU, B=CORNERLOGIS_SKU\nconst map = new Map();\nfor (const r of rows){\n  const k = r[0]; const v = r[1];\n  if (k) map.set(String(k).trim(), v ? String(v).trim() : '');\n}\n\nfunction mapSku(shopbySku){\n  const key = String(shopbySku || '').trim();\n  if (!key) return '';\n  const hit = map.get(key);\n  return (hit && hit.length) ? hit : key; // ê·œì¹™: ë§¤í•‘ ì‹¤íŒ¨ ì‹œ ì›ë˜ SKU ìœ ì§€\n}\n\n// ìƒµë°”ì´ ì£¼ë¬¸ JSON ìŠ¤í‚¤ë§ˆì— ë§ê²Œ í•„ë“œëª… ì¡°ì • í•„ìš”\n// ì•„ë˜ëŠ” ì˜ˆì‹œ(ì£¼ë¬¸ì/ìˆ˜ë ¹ì/ì£¼ì†Œ/ì˜µì…˜ì½”ë“œ/ìˆ˜ëŸ‰/ê²°ì œì‹œê°„/ë©”ëª¨ ë“±)\nreturn orders.map(o => {\n  const receiverName  = o.receiverName || o.ordererName;\n  const receiverPhone = o.receiverContact1 || o.receiverPhone || o.ordererContact1;\n  const zip           = o.receiverZipCode || o.zipCode;\n  const address       = [o.receiverAddress, o.receiverDetailAddress].filter(Boolean).join(' ');\n  const sku           = mapSku(o.optionCode || o.productManagementCd || o.optionManagementCd);\n  const qty           = Number(o.orderCnt || o.quantity || 1);\n  const orderAmt      = Number(o.lastPayAmt || o.totalPrice || 0);\n  const paidAt        = (o.paidYmdt || o.paidAt || o.registerYmdt || '').toString().slice(0,10);\n  const itemPrice     = qty > 0 ? Math.round(orderAmt/qty) : orderAmt;\n  const memo          = o.deliveryMemo || o.orderMemo || '';\n  return {\n    json: {\n      orderNo: o.orderNo,\n      name: receiverName,\n      phone: receiverPhone,\n      zip: zip,\n      address: address,\n      cornerlogisSku: sku,\n      qty: qty,\n      orderAmount: orderAmt,\n      orderDate: paidAt,\n      itemPrice: itemPrice,\n      memo: memo\n    }\n  };\n});"
        },
        "type": "n8n-nodes-base.function",
        "typeVersion": 2,
        "position": [940, 320],
        "name": "í•„ë“œ ë§¤í•‘ & SKU ì¹˜í™˜"
      },
      {
        "parameters": {
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpQueryAuth",
          "requestMethod": "POST",
          "url": "https://api.cornerlogis.com", 
          "jsonParameters": true,
          "options": { "response": { "responseFormat": "json" } },
          "sendBody": true,
          "bodyParametersJson": "={\n  \"orders\": [\n    {\n      \"clientOrderNo\": $json.orderNo,\n      \"receiverName\": $json.name,\n      \"receiverPhone\": $json.phone,\n      \"zipCode\": $json.zip,\n      \"address\": $json.address,\n      \"sku\": $json.cornerlogisSku,\n      \"qty\": $json.qty,\n      \"orderAmount\": $json.orderAmount,\n      \"orderDate\": $json.orderDate,\n      \"itemPrice\": $json.itemPrice,\n      \"memo\": $json.memo\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4,
        "position": [1180, 320],
        "name": "ì½”ë„ˆë¡œì§€ìŠ¤ ì¶œê³  ìƒì„±",
        "notesInFlow": true,
        "notes": "â–¶ Swagger UIì—ì„œ ì‹¤ì œ ì—”ë“œí¬ì¸íŠ¸/í•„ë“œëª… í™•ì¸ í›„ URL/Body êµì²´ (ì˜ˆ: /api/outbound)\nâ–¶ ì¸ì¦ ìŠ¤í‚´(API Key/Bearer ë“±) í¬ë¦¬ë´ì…œ ì—°ê²°"
      },
      {
        "parameters": {
          "requestMethod": "GET",
          "url": "https://api.cornerlogis.com", 
          "options": { "response": { "responseFormat": "json" } },
          "sendQuery": true,
          "queryParametersUi": {
            "parameter": [
              { "name": "clientOrderNo", "value": "={{$json.orderNo}}" }
            ]
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4,
        "position": [1420, 320],
        "name": "ì†¡ì¥ë²ˆí˜¸ ì¡°íšŒ(ì„ íƒ)",
        "notesInFlow": true,
        "notes": "â–¶ í•„ìš” ì‹œ Swaggerì—ì„œ ì¶”ì /ìƒíƒœ ì¡°íšŒ ì—”ë“œí¬ì¸íŠ¸ ì§€ì •"
      },
      {
        "parameters": {
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "requestMethod": "PUT",
          "url": "https://{your-shopby-host}/server/orders/{{$json.orderNo}}/delivery", 
          "jsonParameters": true,
          "options": { "response": { "responseFormat": "json" } },
          "sendBody": true,
          "bodyParametersJson": "={\n  \"deliveryCompany\": \"CJ\",\n  \"trackingNo\": $json.trackingNo,\n  \"status\": \"DELIVERY_PREPARE\"\n}"
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4,
        "position": [1660, 320],
        "name": "ìƒµë°”ì´ ë°°ì†¡ì •ë³´ ì—…ë°ì´íŠ¸",
        "notesInFlow": true,
        "notes": "â–¶ ì‹¤ì œ ë°°ì†¡ ì—…ë°ì´íŠ¸ API ê²½ë¡œ/ë°”ë””ëŠ” shopby ë¬¸ì„œì—ì„œ í™•ì¸í•´ êµì²´\nâ–¶ ìƒíƒœì½”ë“œ ì˜ˆì‹œëŠ” ì›¹í›… ë¬¸ì„œì˜ orderStatusType ì°¸ê³ (PAY_DONE/DELIVERY_PREPARE ë“±)"
      },
      {
        "parameters": {
          "functionCode": "const ok = items.length; return [{json:{message:`Cornerlogis ì—…ë¡œë“œ ${ok}ê±´ ì™„ë£Œ`}}];"
        },
        "type": "n8n-nodes-base.function",
        "typeVersion": 2,
        "position": [1900, 320],
        "name": "ìš”ì•½ ë©”ì‹œì§€"
      }
    ],
    "connections": {
      "ë§¤ì¼ 13:00": { "main": [ [ { "node": "ê¸ˆì¼ 00:00~13:00 ë²”ìœ„", "type": "main", "index": 0 } ] ] },
      "ê¸ˆì¼ 00:00~13:00 ë²”ìœ„": { "main": [ [ { "node": "ìƒµë°”ì´ ì£¼ë¬¸ ì¡°íšŒ", "type": "main", "index": 0 } ] ] },
      "ìƒµë°”ì´ ì£¼ë¬¸ ì¡°íšŒ": {
        "main": [
          [ { "node": "SKU ë§¤í•‘ ì‹œíŠ¸ ì½ê¸°", "type": "main", "index": 0 } ],
          [ { "node": "í•„ë“œ ë§¤í•‘ & SKU ì¹˜í™˜", "type": "main", "index": 0 } ]
        ]
      },
      "SKU ë§¤í•‘ ì‹œíŠ¸ ì½ê¸°": { "main": [ [ { "node": "í•„ë“œ ë§¤í•‘ & SKU ì¹˜í™˜", "type": "main", "index": 1 } ] ] },
      "í•„ë“œ ë§¤í•‘ & SKU ì¹˜í™˜": { "main": [ [ { "node": "ì½”ë„ˆë¡œì§€ìŠ¤ ì¶œê³  ìƒì„±", "type": "main", "index": 0 } ] ] },
      "ì½”ë„ˆë¡œì§€ìŠ¤ ì¶œê³  ìƒì„±": { "main": [ [ { "node": "ì†¡ì¥ë²ˆí˜¸ ì¡°íšŒ(ì„ íƒ)", "type": "main", "index": 0 } ] ] },
      "ì†¡ì¥ë²ˆí˜¸ ì¡°íšŒ(ì„ íƒ)": { "main": [ [ { "node": "ìƒµë°”ì´ ë°°ì†¡ì •ë³´ ì—…ë°ì´íŠ¸", "type": "main", "index": 0 } ] ] },
      "ìƒµë°”ì´ ë°°ì†¡ì •ë³´ ì—…ë°ì´íŠ¸": { "main": [ [ { "node": "ìš”ì•½ ë©”ì‹œì§€", "type": "main", "index": 0 } ] ] }
    }
  }
  